# Test Report - pets_tests

## Environment
- Node Version: v23.11.0
- Platform: darwin
- API URL: http://localhost:3000
- Timestamp: 2025-05-02T17-46-03-932Z

## Summary
- Total Tests: 18
- Passed: 10
- Failed: 8
- Success Rate: 55.56%

## Recommendations

### CRITICAL
Overall test success rate is below 80%. Immediate attention required.

### WARNING
Functionality Issues:
- Sorting functionality does not work properly - consider adding sorting direction (asc/desc)
- Filtering is inconsistent and does not properly filter results

### SUGGESTION
API Design: Consider using GET /api/pets with query parameters for filtering and searching instead of separate search endpoints

## Endpoints Tested

### pets
- Methods: POST, GET
- Total Tests: 9
- Passed: 3
- Failed: 6


### pets/not-a-valid-id
- Methods: GET, DELETE
- Total Tests: 2
- Passed: 2
- Failed: 0


### pets/12345678-1234-1234-1234-123456789012
- Methods: GET
- Total Tests: 1
- Passed: 0
- Failed: 1


### pets?page=1&limit=10
- Methods: GET
- Total Tests: 1
- Passed: 1
- Failed: 0


### pets?species=Dog
- Methods: GET
- Total Tests: 1
- Passed: 0
- Failed: 1


### pets?sort=name
- Methods: GET
- Total Tests: 1
- Passed: 1
- Failed: 0


### pets/search?name=flu
- Methods: GET
- Total Tests: 1
- Passed: 1
- Failed: 0


### pets/search?species=Dog
- Methods: GET
- Total Tests: 1
- Passed: 1
- Failed: 0


### pets/search?name=NonexistentPetName12345
- Methods: GET
- Total Tests: 1
- Passed: 1
- Failed: 0


## Detailed Analysis

### Pet Creation Tests

#### Create pet with valid data
- Status: 500
- Analysis: ❌ Test failed - API behavior does not match expectations

- Request:
```json
{
  "method": "POST",
  "endpoint": "pets",
  "data": {
    "name": "Fluffy",
    "species": "Dog",
    "breed": "Golden Retriever",
    "age": 3,
    "status": "available",
    "description": "Friendly and playful golden retriever",
    "medicalHistory": "All vaccinations up to date",
    "images": [
      "https://dummyimage.com/300x200/ff9900/ffffff&text=Pet%2BImage"
    ]
  }
}
```
- Response:
```json
{
  "status": 500,
  "data": {
    "error": "Error retrieving pet"
  }
}
```


#### Create pet with missing required fields
- Status: 400
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "POST",
  "endpoint": "pets",
  "data": {
    "breed": "Siamese",
    "age": 2,
    "status": "available",
    "images": [
      "https://dummyimage.com/300x200/9900ff/ffffff&text=Cat%2BImage"
    ]
  }
}
```
- Response:
```json
{
  "status": 400,
  "data": {
    "error": "Validation failed",
    "details": [
      {
        "field": "[Object]",
        "message": "[Object]"
      },
      {
        "field": "[Object]",
        "message": "[Object]"
      },
      "[...2 more items]"
    ]
  }
}
```


#### Create pet with invalid data types
- Status: 400
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "POST",
  "endpoint": "pets",
  "data": {
    "name": "Max",
    "species": "Dog",
    "breed": "German Shepherd",
    "age": "not a number",
    "status": "available",
    "images": [
      "https://dummyimage.com/300x200/0099ff/ffffff&text=Dog%2BImage"
    ]
  }
}
```
- Response:
```json
{
  "status": 400,
  "data": {
    "error": "Validation failed",
    "details": [
      {
        "field": "[Object]",
        "message": "[Object]"
      }
    ]
  }
}
```


#### Create pet with unauthorized user
- Status: 401
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "POST",
  "endpoint": "pets",
  "data": {
    "name": "Rex",
    "species": "Dog",
    "breed": "Labrador",
    "age": 4,
    "status": "available",
    "images": [
      "https://dummyimage.com/300x200/009900/ffffff&text=Labrador%2BImage"
    ]
  }
}
```
- Response:
```json
{
  "status": 401,
  "data": {
    "error": "Token no proporcionado"
  }
}
```

### Pet Retrieval Tests

#### Retrieve pet with invalid ID format
- Status: 400
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "GET",
  "endpoint": "pets/not-a-valid-id",
  "data": {
    "petId": "not-a-valid-id"
  }
}
```
- Response:
```json
{
  "status": 400,
  "data": {
    "error": "Invalid pet ID",
    "details": [
      {
        "field": "[Object]",
        "message": "[Object]"
      }
    ]
  }
}
```


#### Delete pet with valid ID - No pet ID available
- Status: 0
- Analysis: ⏭️ Test was skipped - Dependencies not available

- Request:
```json
{
  "method": "GET",
  "endpoint": "unknown"
}
```
- Response:
```json
{
  "status": 0,
  "data": {
    "message": "Test was skipped due to missing dependencies"
  }
}
```


#### Delete pet with invalid ID format
- Status: 400
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "DELETE",
  "endpoint": "pets/not-a-valid-id",
  "data": {
    "petId": "not-a-valid-id"
  }
}
```
- Response:
```json
{
  "status": 400,
  "data": {
    "error": "Invalid pet ID",
    "details": [
      {
        "field": "[Object]",
        "message": "[Object]"
      }
    ]
  }
}
```

### Pet Listing Tests

#### List all pets (paginated)
- Status: 200
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "GET",
  "endpoint": "pets?page=1&limit=10",
  "data": {
    "page": 1,
    "limit": 10
  }
}
```
- Response:
```json
{
  "status": 200,
  "data": [
    {
      "name": "Marcos",
      "species": "Dog",
      "breed": "Labrador",
      "age": 5,
      "gender": "Male",
      "color": "Brown",
      "size": "Large",
      "status": "lost",
      "description": "Friendly dog",
      "location": {
        "latitude": "[Object]",
        "longitude": "[Object]",
        "address": "[Object]"
      },
      "images": [
        "[Object]"
      ],
      "owner": {
        "name": "[Object]",
        "contact": "[Object]"
      },
      "report": {
        "reportedAt": "[Object]",
        "updatedAt": "[Object]"
      },
      "id": "f32410cb-7b14-48f7-a169-52043f128ee1",
      "createdAt": {
        "_seconds": 1741281039,
        "_nanoseconds": 858000000
      },
      "updatedAt": {
        "_seconds": 1741281039,
        "_nanoseconds": 858000000
      }
    },
    {
      "name": "Doggy",
      "species": "Dog",
      "breed": "Labrador",
      "age": 5,
      "gender": "Male",
      "color": "Brown",
      "size": "Large",
      "status": "lost",
      "description": "Friendly dog",
      "location": {
        "latitude": "[Object]",
        "longitude": "[Object]",
        "address": "[Object]"
      },
      "images": [
        "[Object]"
      ],
      "owner": {
        "name": "[Object]",
        "contact": "[Object]"
      },
      "report": {
        "reportedAt": "[Object]",
        "updatedAt": "[Object]"
      },
      "id": "7e11d9ab-8829-44da-8bf4-572e1c30fd82",
      "createdAt": {
        "_seconds": 1741281047,
        "_nanoseconds": 304000000
      },
      "updatedAt": {
        "_seconds": 1741281047,
        "_nanoseconds": 304000000
      }
    },
    "[...8 more items]"
  ]
}
```


#### List pets with filtering (by species)
- Status: 500
- Analysis: ❌ Test failed - API behavior does not match expectations

- Request:
```json
{
  "method": "GET",
  "endpoint": "pets?species=Dog",
  "data": {
    "species": "Dog"
  }
}
```
- Response:
```json
{
  "status": 500,
  "data": {
    "error": "Error retrieving pets",
    "details": "9 FAILED_PRECONDITION: The query requires an index. You can create it here: https://console.firebase...[truncated 244 chars]"
  }
}
```


#### List pets with sorting (by name)
- Status: 200
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "GET",
  "endpoint": "pets?sort=name",
  "data": {
    "sort": "name"
  }
}
```
- Response:
```json
{
  "status": 200,
  "data": [
    {
      "name": "Buddy",
      "species": "dog",
      "breed": "Labrador",
      "age": 4,
      "gender": "male",
      "color": "yellow",
      "size": "large",
      "status": "lost",
      "description_en": "Friendly and energetic",
      "description_es": "Amigable y enérgico",
      "location": {
        "latitude": "[Object]",
        "longitude": "[Object]",
        "address": "[Object]"
      },
      "images": [
        "[Object]"
      ],
      "id": "4f7bf936-f303-4608-9769-fd9dd347bfc6",
      "createdAt": {
        "_seconds": 1745275611,
        "_nanoseconds": 151000000
      },
      "updatedAt": {
        "_seconds": 1745275611,
        "_nanoseconds": 151000000
      }
    },
    {
      "name": "Buddy-2",
      "species": "dog",
      "breed": "Labrador",
      "age": 4,
      "gender": "male",
      "color": "yellow",
      "size": "large",
      "status": "lost",
      "description_en": "Friendly and energetic",
      "description_es": "Amigable y enérgico",
      "location": {
        "latitude": "[Object]",
        "longitude": "[Object]",
        "address": "[Object]"
      },
      "userId": "user123",
      "id": "391e86f5-5cf6-4d47-866d-32a39686deac",
      "createdAt": {
        "_seconds": 1741369112,
        "_nanoseconds": 804000000
      },
      "images": [
        "[Object]",
        "[Object]",
        "[...4 more items]"
      ],
      "updatedAt": {
        "_seconds": 1745275917,
        "_nanoseconds": 178000000
      }
    },
    "[...8 more items]"
  ]
}
```

### Pet Update Tests

#### Update pet with valid data - No pet ID available
- Status: 0
- Analysis: ⏭️ Test was skipped - Dependencies not available

- Request:
```json
{
  "method": "GET",
  "endpoint": "unknown"
}
```
- Response:
```json
{
  "status": 0,
  "data": {
    "message": "Test was skipped due to missing dependencies"
  }
}
```


#### Update pet with invalid data - No pet ID available
- Status: 0
- Analysis: ⏭️ Test was skipped - Dependencies not available

- Request:
```json
{
  "method": "GET",
  "endpoint": "unknown"
}
```
- Response:
```json
{
  "status": 0,
  "data": {
    "message": "Test was skipped due to missing dependencies"
  }
}
```


#### Update pet as non-owner - No pet ID available
- Status: 0
- Analysis: ⏭️ Test was skipped - Dependencies not available

- Request:
```json
{
  "method": "GET",
  "endpoint": "unknown"
}
```
- Response:
```json
{
  "status": 0,
  "data": {
    "message": "Test was skipped due to missing dependencies"
  }
}
```

### Pet Deletion Tests

#### Delete pet as non-owner - No pet ID available
- Status: 0
- Analysis: ⏭️ Test was skipped - Dependencies not available

- Request:
```json
{
  "method": "GET",
  "endpoint": "unknown"
}
```
- Response:
```json
{
  "status": 0,
  "data": {
    "message": "Test was skipped due to missing dependencies"
  }
}
```

### Pet Search Tests

#### Search pets by name
- Status: 200
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "GET",
  "endpoint": "pets/search?name=flu",
  "data": {
    "searchQuery": "flu"
  }
}
```
- Response:
```json
{
  "status": 200,
  "data": {
    "results": [
      {
        "name": "[Object]",
        "species": "[Object]",
        "breed": "[Object]",
        "age": "[Object]",
        "status": "[Object]",
        "description": "[Object]",
        "medicalHistory": "[Object]",
        "images": "[Object]",
        "id": "[Object]",
        "createdAt": "[Object]",
        "updatedAt": "[Object]"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 1,
      "hasMore": false
    }
  }
}
```


#### Search pets by species
- Status: 200
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "GET",
  "endpoint": "pets/search?species=Dog",
  "data": {
    "searchQuery": "Dog"
  }
}
```
- Response:
```json
{
  "status": 200,
  "data": {
    "results": [
      {
        "name": "[Object]",
        "species": "[Object]",
        "breed": "[Object]",
        "age": "[Object]",
        "gender": "[Object]",
        "color": "[Object]",
        "size": "[Object]",
        "status": "[Object]",
        "description_en": "[Object]",
        "description_es": "[Object]",
        "location": "[Object]",
        "images": "[Object]",
        "id": "[Object]",
        "createdAt": "[Object]",
        "updatedAt": "[Object]"
      },
      {
        "name": "[Object]",
        "species": "[Object]",
        "breed": "[Object]",
        "age": "[Object]",
        "gender": "[Object]",
        "color": "[Object]",
        "size": "[Object]",
        "status": "[Object]",
        "description_en": "[Object]",
        "description_es": "[Object]",
        "location": "[Object]",
        "userId": "[Object]",
        "id": "[Object]",
        "createdAt": "[Object]",
        "images": "[Object]",
        "updatedAt": "[Object]"
      },
      "[...8 more items]"
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 10,
      "hasMore": true
    }
  }
}
```


#### Search with no results
- Status: 200
- Analysis: ✅ Test passed - API behavior matches expectations

- Request:
```json
{
  "method": "GET",
  "endpoint": "pets/search?name=NonexistentPetName12345",
  "data": {
    "searchQuery": "NonexistentPetName12345"
  }
}
```
- Response:
```json
{
  "status": 200,
  "data": {
    "results": [],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 0,
      "hasMore": false
    }
  }
}
```
