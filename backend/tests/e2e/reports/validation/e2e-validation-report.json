{
  "timestamp": "2025-06-05T17:10:31.979Z",
  "totalSuites": 10,
  "passedSuites": 1,
  "failedSuites": 9,
  "successRate": "10.0",
  "totalDuration": "138.69",
  "results": [
    {
      "suite": "auth",
      "description": "Authentication and authorization",
      "file": "auth.e2e.js",
      "success": true,
      "exitCode": 0,
      "duration": 7.111,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: auth\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:08:13 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - AUTH\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: auth.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/auth.e2e.js\u001b[0m\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    [ENHANCED REPORT] Generated: /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/reports/auth.e2e/2025-06-05-1908-auth-tests.md\n\n      at EnhancedReporter.log [as writeReport] (tests/e2e/helpers/report.js:290:13)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n----------|---------|----------|---------|---------|-------------------\nFile      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n----------|---------|----------|---------|---------|-------------------\nAll files |       0 |        0 |       0 |       0 |                   \n----------|---------|----------|---------|---------|-------------------\n\u001b[32m✓ E2E tests completed successfully for suite: auth\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST COMPLETED SUCCESSFULLY\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ Total duration: 7.00 seconds\u001b[0m\n\u001b[34mℹ Detailed reports generated by individual test files in tests/e2e/reports/[test-name].e2e/\u001b[0m\n",
      "stderr": "PASS tests/e2e/auth.e2e.js\n  E2E: Auth\n    ✓ should register a user (1239 ms)\n    ✓ should login user (269 ms)\n    ✓ should deny login with wrong credentials (311 ms)\n    ✓ should access profile with token (561 ms)\n    ✓ should deny access to profile without token (21 ms)\n    ✓ should login as superadmin (311 ms)\n    ✓ should list users as admin (529 ms)\n\nTest Suites: 1 passed, 1 total\nTests:       7 passed, 7 total\nSnapshots:   0 total\nTime:        4.429 s, estimated 6 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/auth.e2e.js/i.\n\nJest has detected the following 1 open handle potentially keeping Jest from exiting:\n\n  ●  TCPWRAP\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                                      ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at RedirectableRequest.Object.<anonymous>.RedirectableRequest._performRequest (node_modules/follow-redirects/index.js:337:24)\n      at new RedirectableRequest (node_modules/follow-redirects/index.js:111:8)\n      at Object.request (node_modules/follow-redirects/index.js:543:14)\n      at dispatchHttpRequest (node_modules/axios/lib/adapters/http.js:464:21)\n      at node_modules/axios/lib/adapters/http.js:152:5\n      at wrapAsync (node_modules/axios/lib/adapters/http.js:132:10)\n      at http (node_modules/axios/lib/adapters/http.js:170:10)\n      at Axios.dispatchRequest (node_modules/axios/lib/core/dispatchRequest.js:51:10)\n      at Axios._request (node_modules/axios/lib/core/Axios.js:187:33)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:40:25)\n      at Axios.<computed> [as get] (node_modules/axios/lib/core/Axios.js:213:17)\n      at Function.wrap [as get] (node_modules/axios/lib/helpers/bind.js:5:15)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:38)\n      at Object.get (tests/e2e/auth.e2e.js:93:34)\n\n",
      "timestamp": "2025-06-05T17:08:20.415Z"
    },
    {
      "suite": "users",
      "description": "User management",
      "file": "users.e2e.js",
      "success": false,
      "exitCode": 1,
      "duration": 5.494,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: users\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:08:21 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - USERS\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: users.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/users.e2e.js\u001b[0m\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    [ENHANCED REPORT] Generated: /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/reports/users.e2e/2025-06-05-1908-users-tests.md\n\n      at EnhancedReporter.log [as writeReport] (tests/e2e/helpers/report.js:290:13)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n----------|---------|----------|---------|---------|-------------------\nFile      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n----------|---------|----------|---------|---------|-------------------\nAll files |       0 |        0 |       0 |       0 |                   \n----------|---------|----------|---------|---------|-------------------\n\u001b[31m✗ E2E tests failed with exit code: 1\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST FAILED\u001b[0m\u001b[0m\n============================================================\n\u001b[31m✗ Error: Tests failed with code 1\u001b[0m\n\u001b[31m✗ Total duration: 5.21 seconds\u001b[0m\n\u001b[34mℹ Check detailed reports in tests/e2e/reports/[test-name].e2e/ for more information\u001b[0m\n",
      "stderr": "FAIL tests/e2e/users.e2e.js\n  E2E: Users\n    ✕ should create a user (3 ms)\n    ✕ should get user by ID (1 ms)\n    ✕ should list users\n    ✕ should update user\n    ✕ should change user role\n    ✕ should delete user (1 ms)\n\n  ● E2E: Users › should create a user\n\n    TypeError: Cannot read properties of undefined (reading 'idToken')\n\n      25 |       password: process.env.ADMIN_PASSWORD\n      26 |     });\n    > 27 |     adminToken = loginResponse.data.tokens.idToken;\n         |                                            ^\n      28 |     headers = { Authorization: `Bearer ${adminToken}` };\n      29 |   });\n      30 |\n\n      at Object.idToken (tests/e2e/users.e2e.js:27:44)\n\n  ● E2E: Users › should get user by ID\n\n    TypeError: Cannot read properties of undefined (reading 'idToken')\n\n      25 |       password: process.env.ADMIN_PASSWORD\n      26 |     });\n    > 27 |     adminToken = loginResponse.data.tokens.idToken;\n         |                                            ^\n      28 |     headers = { Authorization: `Bearer ${adminToken}` };\n      29 |   });\n      30 |\n\n      at Object.idToken (tests/e2e/users.e2e.js:27:44)\n\n  ● E2E: Users › should list users\n\n    TypeError: Cannot read properties of undefined (reading 'idToken')\n\n      25 |       password: process.env.ADMIN_PASSWORD\n      26 |     });\n    > 27 |     adminToken = loginResponse.data.tokens.idToken;\n         |                                            ^\n      28 |     headers = { Authorization: `Bearer ${adminToken}` };\n      29 |   });\n      30 |\n\n      at Object.idToken (tests/e2e/users.e2e.js:27:44)\n\n  ● E2E: Users › should update user\n\n    TypeError: Cannot read properties of undefined (reading 'idToken')\n\n      25 |       password: process.env.ADMIN_PASSWORD\n      26 |     });\n    > 27 |     adminToken = loginResponse.data.tokens.idToken;\n         |                                            ^\n      28 |     headers = { Authorization: `Bearer ${adminToken}` };\n      29 |   });\n      30 |\n\n      at Object.idToken (tests/e2e/users.e2e.js:27:44)\n\n  ● E2E: Users › should change user role\n\n    TypeError: Cannot read properties of undefined (reading 'idToken')\n\n      25 |       password: process.env.ADMIN_PASSWORD\n      26 |     });\n    > 27 |     adminToken = loginResponse.data.tokens.idToken;\n         |                                            ^\n      28 |     headers = { Authorization: `Bearer ${adminToken}` };\n      29 |   });\n      30 |\n\n      at Object.idToken (tests/e2e/users.e2e.js:27:44)\n\n  ● E2E: Users › should delete user\n\n    TypeError: Cannot read properties of undefined (reading 'idToken')\n\n      25 |       password: process.env.ADMIN_PASSWORD\n      26 |     });\n    > 27 |     adminToken = loginResponse.data.tokens.idToken;\n         |                                            ^\n      28 |     headers = { Authorization: `Bearer ${adminToken}` };\n      29 |   });\n      30 |\n\n      at Object.idToken (tests/e2e/users.e2e.js:27:44)\n\nTest Suites: 1 failed, 1 total\nTests:       6 failed, 6 total\nSnapshots:   0 total\nTime:        2.265 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/users.e2e.js/i.\n",
      "timestamp": "2025-06-05T17:08:26.915Z"
    },
    {
      "suite": "organizations",
      "description": "Organization management",
      "file": "organizations.e2e.js",
      "success": false,
      "exitCode": 1,
      "duration": 27.425,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: organizations\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:08:28 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - ORGANIZATIONS\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: organizations.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/organizations.e2e.js\u001b[0m\n  console.log\n    [Firebase] Usando credenciales: ./config/pet-api-dev-35115-68f396572cad.json\n\n      at Object.log (config/firebase.js:11:13)\n\n  console.log\n    [Firebase] Tipo: service_account Email: firebase-adminsdk-fbsvc@pet-api-dev-35115.iam.gserviceaccount.com\n\n      at Object.log (config/firebase.js:12:13)\n\n  console.log\n    [Firebase] Bucket configurado: pet-api-dev-35115.firebasestorage.app\n\n      at Object.log (config/firebase.js:21:9)\n\n  console.log\n    Firebase Admin Initialized for project: pet-api-dev-35115\n\n      at Object.log (config/firebase.js:30:9)\n\n  console.log\n    Prisma Client initialized for PostgreSQL connection\n\n      at Object.log (config/prisma.js:17:9)\n\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🔍 DEBUG: Update org ID: undefined\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🔍 DEBUG: Update data: {\n      \"name\": \"Updated undefined\",\n      \"description\": \"Updated description\",\n      \"phone\": \"+9876543210\"\n    }\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🔍 DEBUG: Admin token length: 1154\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🔍 DEBUG: Admin token start: eyJhbGciOiJSUzI1NiIsImtpZCI6IjZlODk1YzQ3YTA0YzVmNm\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🔍 DEBUG: Error response status: 400\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🔍 DEBUG: Error response data: {\n      \"error\": \"Invalid organization ID\",\n      \"details\": [\n        \"Organization ID must be a valid UUID\"\n      ]\n    }\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🔍 DEBUG: Error message: Request failed with status code 400\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Starting cleanup of test data...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organizations.e2e.js:36:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organizations.e2e.js:36:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organizations.e2e.js:36:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organizations.e2e.js:36:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organizations.e2e.js:36:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organizations.e2e.js:36:5)\n\n  console.log\n    Cleaned up user: test-user-org-1749143311656@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Cleaned up user: org1-admin-1749143322944@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Cleaned up user: org2-admin-1749143323877@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Test data cleanup completed\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    [ENHANCED REPORT] Generated: /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/reports/organizations.e2e/2025-06-05-1908-organizations-tests.md\n\n      at EnhancedReporter.log [as writeReport] (tests/e2e/helpers/report.js:290:13)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n\u001b[31m✗ E2E tests failed with exit code: 1\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST FAILED\u001b[0m\u001b[0m\n============================================================\n\u001b[31m✗ Error: Tests failed with code 1\u001b[0m\n\u001b[31m✗ Total duration: 27.29 seconds\u001b[0m\n\u001b[34mℹ Check detailed reports in tests/e2e/reports/[test-name].e2e/ for more information\u001b[0m\n",
      "stderr": "FAIL tests/e2e/organizations.e2e.js (25.259 s)\n  Organizations E2E Tests\n    Create Organization\n      ✕ Admin should create organization successfully (1107 ms)\n      ✕ Regular user should create organization successfully (457 ms)\n      ✕ Should create organization with explicit shelter type (603 ms)\n      ✓ Should fail without authentication (70 ms)\n    Get Organization by ID\n      ✕ Admin should get organization by ID (451 ms)\n      ✓ Should fail with invalid organization ID (428 ms)\n      ✓ Should fail without authentication (10 ms)\n    Update Organization\n      ✕ Admin should update organization successfully (482 ms)\n      ✕ Should fail without proper permissions (453 ms)\n    Delete Organization\n      ✕ Admin should delete organization successfully (553 ms)\n      ✕ Should fail without proper permissions (890 ms)\n    List Organizations\n      ✕ Admin should list all organizations (867 ms)\n      ✓ Should fail without admin permissions (436 ms)\n    Get Organization Members\n      ✕ Admin should get organization members (497 ms)\n      ✕ Should fail without membership (465 ms)\n    Multitenancy Validation\n      ✕ Organization admin should only access their own organization (467 ms)\n      ✕ Super admin should access all organizations (498 ms)\n\n  ● Organizations E2E Tests › Create Organization › Admin should create organization successfully\n\n    expect(received).toHaveProperty(path)\n\n    Expected path: \"id\"\n    Received path: []\n\n    Received value: {\"data\": {\"address\": \"123 Test Street\", \"createdAt\": \"2025-06-05T17:08:33.431Z\", \"createdBy\": \"tYFy4ecd0TY2fErw9jsp6e1XHvw1\", \"defaultLanguage\": \"en\", \"description\": \"Test organization for E2E testing\", \"email\": \"test@organization.com\", \"id\": \"157e5517-6fdc-4227-98d2-a1155eb758fa\", \"logo\": null, \"name\": \"Test Organization 1749143312937\", \"phone\": \"+1234567890\", \"status\": \"active\", \"type\": \"shelter\", \"updatedAt\": \"2025-06-05T17:08:33.431Z\"}, \"language\": \"en\", \"message\": \"Organization created successfully\", \"messageKey\": \"organizations.created\", \"success\": true}\n\n      64 |\n      65 |       expect(response.status).toBe(201);\n    > 66 |       expect(response.data).toHaveProperty('id');\n         |                             ^\n      67 |       expect(response.data.name).toBe(organizationData.name);\n      68 |       expect(response.data.createdBy).toBe(adminUserId);\n      69 |       // Verify default type is set\n\n      at toHaveProperty (tests/e2e/organizations.e2e.js:66:29)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Create Organization › Regular user should create organization successfully\n\n    expect(received).toHaveProperty(path)\n\n    Expected path: \"id\"\n    Received path: []\n\n    Received value: {\"data\": {\"address\": \"789 User Street\", \"createdAt\": \"2025-06-05T17:08:34.451Z\", \"createdBy\": \"qSOy1KL02XgUOpT0FOihENnhylx2\", \"defaultLanguage\": \"en\", \"description\": \"Organization created by regular user\", \"email\": \"user-org-1749143314064@example.com\", \"id\": \"7e1889c6-4ce1-4072-ab82-58d5a7927168\", \"logo\": null, \"name\": \"User Org 1749143314064\", \"phone\": \"+1555666777\", \"status\": \"active\", \"type\": \"shelter\", \"updatedAt\": \"2025-06-05T17:08:34.451Z\"}, \"language\": \"en\", \"message\": \"Organization created successfully\", \"messageKey\": \"organizations.created\", \"success\": true}\n\n      92 |\n      93 |       expect(response.status).toBe(201);\n    > 94 |       expect(response.data).toHaveProperty('id');\n         |                             ^\n      95 |       expect(response.data.name).toBe(organizationData.name);\n      96 |       expect(response.data.createdBy).toBe(regularUserId);\n      97 |       // Verify default type is set\n\n      at toHaveProperty (tests/e2e/organizations.e2e.js:94:29)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Create Organization › Should create organization with explicit shelter type\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      121 |\n      122 |       expect(response.status).toBe(201);\n    > 123 |       expect(response.data.type).toBe('shelter');\n          |                                  ^\n      124 |       expect(response.data.name).toBe(organizationData.name);\n      125 |       \n      126 |       // Store for cleanup\n\n      at toBe (tests/e2e/organizations.e2e.js:123:34)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Get Organization by ID › Admin should get organization by ID\n\n    AxiosError: Request failed with status code 400\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at tests/e2e/organizations.e2e.js:172:24\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Update Organization › Admin should update organization successfully\n\n    AxiosError: Request failed with status code 400\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at tests/e2e/organizations.e2e.js:246:26\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Update Organization › Should fail without proper permissions\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 400\n\n      279 |         fail('Should have thrown an error');\n      280 |       } catch (error) {\n    > 281 |         expect(error.response.status).toBe(403);\n          |                                       ^\n      282 |       }\n      283 |     });\n      284 |   });\n\n      at toBe (tests/e2e/organizations.e2e.js:281:39)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Delete Organization › Admin should delete organization successfully\n\n    AxiosError: Request failed with status code 400\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at tests/e2e/organizations.e2e.js:309:24\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Delete Organization › Should fail without proper permissions\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 400\n\n      358 |         fail('Should have thrown an error');\n      359 |       } catch (error) {\n    > 360 |         expect(error.response.status).toBe(403);\n          |                                       ^\n      361 |       }\n      362 |     });\n      363 |   });\n\n      at toBe (tests/e2e/organizations.e2e.js:360:39)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › List Organizations › Admin should list all organizations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: false\n\n      373 |\n      374 |       expect(response.status).toBe(200);\n    > 375 |       expect(Array.isArray(response.data)).toBe(true);\n          |                                            ^\n      376 |       expect(response.data.length).toBeGreaterThan(0);\n      377 |     });\n      378 |\n\n      at toBe (tests/e2e/organizations.e2e.js:375:44)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Get Organization Members › Admin should get organization members\n\n    AxiosError: Request failed with status code 400\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at tests/e2e/organizations.e2e.js:417:24\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Get Organization Members › Should fail without membership\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 400\n\n      436 |         fail('Should have thrown an error');\n      437 |       } catch (error) {\n    > 438 |         expect(error.response.status).toBe(403);\n          |                                       ^\n      439 |       }\n      440 |     });\n      441 |   });\n\n      at toBe (tests/e2e/organizations.e2e.js:438:39)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Multitenancy Validation › Organization admin should only access their own organization\n\n    AxiosError: Request failed with status code 400\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at tests/e2e/organizations.e2e.js:509:25\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organizations E2E Tests › Multitenancy Validation › Super admin should access all organizations\n\n    AxiosError: Request failed with status code 400\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at tests/e2e/organizations.e2e.js:536:25\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\nTest Suites: 1 failed, 1 total\nTests:       13 failed, 4 passed, 17 total\nSnapshots:   0 total\nTime:        25.407 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/organizations.e2e.js/i.\nTest Suites: 1 failed, 1 total\nTests:       13 failed, 4 passed, 17 total\nSnapshots:   0 total\nTime:        25.434 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/organizations.e2e.js/i.\n",
      "timestamp": "2025-06-05T17:08:55.342Z"
    },
    {
      "suite": "organization-types",
      "description": "Organization types",
      "file": "organization-types.e2e.js",
      "success": false,
      "exitCode": 1,
      "duration": 18.752,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: organization-types\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:08:56 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - ORGANIZATION-TYPES\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: organization-types.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/organization-types.e2e.js\u001b[0m\n  console.log\n    [Firebase] Usando credenciales: ./config/pet-api-dev-35115-68f396572cad.json\n\n      at Object.log (config/firebase.js:11:13)\n\n  console.log\n    [Firebase] Tipo: service_account Email: firebase-adminsdk-fbsvc@pet-api-dev-35115.iam.gserviceaccount.com\n\n      at Object.log (config/firebase.js:12:13)\n\n  console.log\n    [Firebase] Bucket configurado: pet-api-dev-35115.firebasestorage.app\n\n      at Object.log (config/firebase.js:21:9)\n\n  console.log\n    Firebase Admin Initialized for project: pet-api-dev-35115\n\n      at Object.log (config/firebase.js:30:9)\n\n  console.log\n    Prisma Client initialized for PostgreSQL connection\n\n      at Object.log (config/prisma.js:17:9)\n\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Starting cleanup of test data...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types.e2e.js:36:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types.e2e.js:36:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types.e2e.js:36:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types.e2e.js:36:5)\n\n  console.log\n    Cleaned up user: test-user-org-types-1749143340428@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Test data cleanup completed\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    [ENHANCED REPORT] Generated: /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/reports/organization-types.e2e/2025-06-05-1909-organization-types-tests.md\n\n      at EnhancedReporter.log [as writeReport] (tests/e2e/helpers/report.js:290:13)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n\u001b[31m✗ E2E tests failed with exit code: 1\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST FAILED\u001b[0m\u001b[0m\n============================================================\n\u001b[31m✗ Error: Tests failed with code 1\u001b[0m\n\u001b[31m✗ Total duration: 18.66 seconds\u001b[0m\n\u001b[34mℹ Check detailed reports in tests/e2e/reports/[test-name].e2e/ for more information\u001b[0m\n",
      "stderr": "FAIL tests/e2e/organization-types.e2e.js (16.236 s)\n  Organization Types E2E Tests\n    Get Organization Types\n      ✕ Should get all available organization types (534 ms)\n      ✕ Regular user should also get organization types (369 ms)\n      ✓ Should fail without authentication (64 ms)\n    Get Specific Organization Type\n      ✕ Should get shelter type information (483 ms)\n      ✓ Should fail for invalid organization type (508 ms)\n      ✓ Should fail without authentication (9 ms)\n    Create Organization with Type\n      ✕ Should create shelter organization successfully (662 ms)\n      ✕ Should create organization with default type when not specified (517 ms)\n      ✓ Should fail with invalid organization type (487 ms)\n      ✓ Should validate required fields for shelter type (507 ms)\n      ✓ Should handle empty string type (362 ms)\n    Update Organization Type\n      ✕ Should update organization type successfully (361 ms)\n      ✕ Should fail when updating to invalid type (376 ms)\n    Filter Organizations by Type\n      ✕ Should filter organizations by shelter type (778 ms)\n      ✓ Should fail with invalid type filter (520 ms)\n      ✕ Should return all organizations when no type filter is applied (752 ms)\n    Organization Type Validation Edge Cases\n      ✓ Should handle null type (478 ms)\n      ✓ Should handle case sensitivity (371 ms)\n\n  ● Organization Types E2E Tests › Get Organization Types › Should get all available organization types\n\n    expect(received).toBeDefined()\n\n    Received: undefined\n\n      56 |       expect(response.status).toBe(200);\n      57 |       expect(typeof response.data).toBe('object');\n    > 58 |       expect(response.data.shelter).toBeDefined();\n         |                                     ^\n      59 |       expect(response.data.shelter.id).toBe('shelter');\n      60 |       expect(response.data.shelter.name).toBe('Protectora de Animales');\n      61 |       expect(response.data.shelter.features).toBeDefined();\n\n      at toBeDefined (tests/e2e/organization-types.e2e.js:58:37)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types E2E Tests › Get Organization Types › Regular user should also get organization types\n\n    expect(received).toBeDefined()\n\n    Received: undefined\n\n      74 |\n      75 |       expect(response.status).toBe(200);\n    > 76 |       expect(response.data.shelter).toBeDefined();\n         |                                     ^\n      77 |     });\n      78 |\n      79 |     test('Should fail without authentication', async () => {\n\n      at toBeDefined (tests/e2e/organization-types.e2e.js:76:37)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types E2E Tests › Get Specific Organization Type › Should get shelter type information\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n       97 |\n       98 |       expect(response.status).toBe(200);\n    >  99 |       expect(response.data.id).toBe('shelter');\n          |                                ^\n      100 |       expect(response.data.name).toBe('Protectora de Animales');\n      101 |       expect(response.data.description).toContain('rescate');\n      102 |       expect(response.data.features).toContain('pet_adoption');\n\n      at toBe (tests/e2e/organization-types.e2e.js:99:32)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types E2E Tests › Create Organization with Type › Should create shelter organization successfully\n\n    expect(received).toHaveProperty(path)\n\n    Expected path: \"id\"\n    Received path: []\n\n    Received value: {\"data\": {\"address\": \"123 Shelter Street\", \"createdAt\": \"2025-06-05T17:09:04.280Z\", \"createdBy\": \"tYFy4ecd0TY2fErw9jsp6e1XHvw1\", \"defaultLanguage\": \"en\", \"description\": \"Test shelter for E2E testing\", \"email\": \"test-shelter-1749143343749@example.com\", \"id\": \"7de15f6b-1f68-4bf1-90fc-1002fd0e5903\", \"logo\": null, \"name\": \"Test Shelter 1749143343749\", \"phone\": \"+1234567890\", \"status\": \"active\", \"type\": \"shelter\", \"updatedAt\": \"2025-06-05T17:09:04.280Z\"}, \"language\": \"en\", \"message\": \"Organization created successfully\", \"messageKey\": \"organizations.created\", \"success\": true}\n\n      153 |\n      154 |       expect(response.status).toBe(201);\n    > 155 |       expect(response.data).toHaveProperty('id');\n          |                             ^\n      156 |       expect(response.data.name).toBe(organizationData.name);\n      157 |       expect(response.data.type).toBe('shelter');\n      158 |       expect(response.data.createdBy).toBe(adminUserId);\n\n      at toHaveProperty (tests/e2e/organization-types.e2e.js:155:29)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types E2E Tests › Create Organization with Type › Should create organization with default type when not specified\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      180 |\n      181 |       expect(response.status).toBe(201);\n    > 182 |       expect(response.data.type).toBe('shelter'); // Default type\n          |                                  ^\n      183 |       \n      184 |       // Store for cleanup\n      185 |       testOrganizations.push(response.data);\n\n      at toBe (tests/e2e/organization-types.e2e.js:182:34)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types E2E Tests › Update Organization Type › Should update organization type successfully\n\n    AxiosError: Request failed with status code 400\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at tests/e2e/organization-types.e2e.js:295:24\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types E2E Tests › Update Organization Type › Should fail when updating to invalid type\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"Validation failed\"\n    Received: \"Invalid organization ID\"\n\n      322 |       } catch (error) {\n      323 |         expect(error.response.status).toBe(400);\n    > 324 |         expect(error.response.data.error).toBe('Validation failed');\n          |                                           ^\n      325 |         expect(error.response.data.details).toBeDefined();\n      326 |       }\n      327 |     });\n\n      at toBe (tests/e2e/organization-types.e2e.js:324:43)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types E2E Tests › Filter Organizations by Type › Should filter organizations by shelter type\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: false\n\n      359 |\n      360 |       expect(response.status).toBe(200);\n    > 361 |       expect(Array.isArray(response.data)).toBe(true);\n          |                                            ^\n      362 |       expect(response.data.length).toBeGreaterThan(0);\n      363 |       \n      364 |       // All returned organizations should be of type 'shelter'\n\n      at toBe (tests/e2e/organization-types.e2e.js:361:44)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types E2E Tests › Filter Organizations by Type › Should return all organizations when no type filter is applied\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: false\n\n      392 |\n      393 |       expect(response.status).toBe(200);\n    > 394 |       expect(Array.isArray(response.data)).toBe(true);\n          |                                            ^\n      395 |       expect(response.data.length).toBeGreaterThan(0);\n      396 |     });\n      397 |   });\n\n      at toBe (tests/e2e/organization-types.e2e.js:394:44)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\nTest Suites: 1 failed, 1 total\nTests:       9 failed, 9 passed, 18 total\nSnapshots:   0 total\nTime:        16.382 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/organization-types.e2e.js/i.\n",
      "timestamp": "2025-06-05T17:09:15.096Z"
    },
    {
      "suite": "organization-types-integration",
      "description": "Organization types integration",
      "file": "organization-types-integration.e2e.js",
      "success": false,
      "exitCode": 1,
      "duration": 17.652,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: organization-types-integration\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:09:16 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - ORGANIZATION-TYPES-INTEGRATION\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: organization-types-integration.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/organization-types-integration.e2e.js\u001b[0m\n  console.log\n    [Firebase] Usando credenciales: ./config/pet-api-dev-35115-68f396572cad.json\n\n      at Object.log (config/firebase.js:11:13)\n\n  console.log\n    [Firebase] Tipo: service_account Email: firebase-adminsdk-fbsvc@pet-api-dev-35115.iam.gserviceaccount.com\n\n      at Object.log (config/firebase.js:12:13)\n\n  console.log\n    [Firebase] Bucket configurado: pet-api-dev-35115.firebasestorage.app\n\n      at Object.log (config/firebase.js:21:9)\n\n  console.log\n    Firebase Admin Initialized for project: pet-api-dev-35115\n\n      at Object.log (config/firebase.js:30:9)\n\n  console.log\n    Prisma Client initialized for PostgreSQL connection\n\n      at Object.log (config/prisma.js:17:9)\n\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Starting cleanup of test data...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:37:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:37:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:37:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:37:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:37:5)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:37:5)\n\n  console.log\n    Cleaned up user: test-user-integration-1749143359678@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Cleaned up user: shelter-member-1749143363051@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Test data cleanup completed\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    [ENHANCED REPORT] Generated: /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/reports/organization-types-integration.e2e/2025-06-05-1909-organization-types-integration-tests.md\n\n      at EnhancedReporter.log [as writeReport] (tests/e2e/helpers/report.js:290:13)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n\u001b[31m✗ E2E tests failed with exit code: 1\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST FAILED\u001b[0m\u001b[0m\n============================================================\n\u001b[31m✗ Error: Tests failed with code 1\u001b[0m\n\u001b[31m✗ Total duration: 17.50 seconds\u001b[0m\n\u001b[34mℹ Check detailed reports in tests/e2e/reports/[test-name].e2e/ for more information\u001b[0m\n",
      "stderr": "FAIL tests/e2e/organization-types-integration.e2e.js (15.512 s)\n  Organization Types Integration E2E Tests\n    Shelter Organizations with Pets Integration\n      ✕ Should verify shelter organization has correct type and features (5 ms)\n      ✕ Should list pets filtered by shelter organization (1 ms)\n    Organization Type Permissions Validation\n      ✕ Shelter members should have appropriate permissions\n      ✕ Should validate required fields for shelter type (1 ms)\n    Multi-Organization Type Scenarios\n      ✕ Should handle multiple shelter organizations correctly (1763 ms)\n    Backward Compatibility\n      ✕ Existing organizations without explicit type should default to shelter (493 ms)\n      ✕ Should handle organization updates without breaking type field (1014 ms)\n\n  ● Organization Types Integration E2E Tests › Shelter Organizations with Pets Integration › Should verify shelter organization has correct type and features\n\n    AxiosError: Request failed with status code 500\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:71:7)\n\n  ● Organization Types Integration E2E Tests › Shelter Organizations with Pets Integration › Should list pets filtered by shelter organization\n\n    AxiosError: Request failed with status code 500\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:71:7)\n\n  ● Organization Types Integration E2E Tests › Organization Type Permissions Validation › Shelter members should have appropriate permissions\n\n    AxiosError: Request failed with status code 500\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:191:7)\n\n  ● Organization Types Integration E2E Tests › Organization Type Permissions Validation › Should validate required fields for shelter type\n\n    AxiosError: Request failed with status code 500\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at Object.<anonymous> (tests/e2e/organization-types-integration.e2e.js:191:7)\n\n  ● Organization Types Integration E2E Tests › Multi-Organization Type Scenarios › Should handle multiple shelter organizations correctly\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      269 |       // Verify all are shelter type\n      270 |       for (const shelter of shelters) {\n    > 271 |         expect(shelter.type).toBe('shelter');\n          |                              ^\n      272 |       }\n      273 |\n      274 |       // Filter organizations by shelter type\n\n      at toBe (tests/e2e/organization-types-integration.e2e.js:271:30)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types Integration E2E Tests › Backward Compatibility › Existing organizations without explicit type should default to shelter\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      416 |\n      417 |       expect(response.status).toBe(201);\n    > 418 |       expect(response.data.type).toBe('shelter'); // Should default to shelter\n          |                                  ^\n      419 |       \n      420 |       testOrganizations.push(response.data);\n      421 |     });\n\n      at toBe (tests/e2e/organization-types-integration.e2e.js:418:34)\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\n  ● Organization Types Integration E2E Tests › Backward Compatibility › Should handle organization updates without breaking type field\n\n    AxiosError: Request failed with status code 400\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at tests/e2e/organization-types-integration.e2e.js:443:30\n      at Object.<anonymous> (tests/e2e/helpers/report.js:310:9)\n\nTest Suites: 1 failed, 1 total\nTests:       7 failed, 7 total\nSnapshots:   0 total\nTime:        15.67 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/organization-types-integration.e2e.js/i.\n",
      "timestamp": "2025-06-05T17:09:33.749Z"
    },
    {
      "suite": "memberships",
      "description": "Membership management",
      "file": "memberships.e2e.js",
      "success": false,
      "exitCode": 1,
      "duration": 21.42,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: memberships\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:09:34 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - MEMBERSHIPS\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: memberships.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/memberships.e2e.js\u001b[0m\n  console.log\n    [Firebase] Usando credenciales: ./config/pet-api-dev-35115-68f396572cad.json\n\n      at Object.log (config/firebase.js:11:13)\n\n  console.log\n    [Firebase] Tipo: service_account Email: firebase-adminsdk-fbsvc@pet-api-dev-35115.iam.gserviceaccount.com\n\n      at Object.log (config/firebase.js:12:13)\n\n  console.log\n    [Firebase] Bucket configurado: pet-api-dev-35115.firebasestorage.app\n\n      at Object.log (config/firebase.js:21:9)\n\n  console.log\n    Firebase Admin Initialized for project: pet-api-dev-35115\n\n      at Object.log (config/firebase.js:30:9)\n\n  console.log\n    Prisma Client initialized for PostgreSQL connection\n\n      at Object.log (config/prisma.js:17:9)\n\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Failed to cleanup other organization: Request failed with status code 400\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Starting cleanup of test data...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/memberships.e2e.js:55:5)\n\n  console.log\n    Cleaned up user: test-user-membership-1749143379194@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Cleaned up user: invite-user-1749143381126@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Cleaned up user: remove-user-1749143382171@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Cleaned up user: self-leave-user-1749143383766@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Cleaned up user: other-org-admin-1749143385776@example.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Test data cleanup completed\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    [ENHANCED REPORT] Generated: /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/reports/memberships.e2e/2025-06-05-1909-memberships-tests.md\n\n      at EnhancedReporter.log [as writeReport] (tests/e2e/helpers/report.js:290:13)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n\u001b[31m✗ E2E tests failed with exit code: 1\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST FAILED\u001b[0m\u001b[0m\n============================================================\n\u001b[31m✗ Error: Tests failed with code 1\u001b[0m\n\u001b[31m✗ Total duration: 21.30 seconds\u001b[0m\n\u001b[34mℹ Check detailed reports in tests/e2e/reports/[test-name].e2e/ for more information\u001b[0m\n",
      "stderr": "FAIL tests/e2e/memberships.e2e.js (18.769 s)\n  Memberships E2E Tests\n    Invite User to Organization\n      ✕ Admin should invite user to organization successfully (1 ms)\n      ✕ Should fail to invite same user twice (1 ms)\n      ✕ Regular user should fail to invite without admin permissions\n      ✕ Should invite user with different roles\n    Get Memberships\n      ✕ Admin should get memberships by organization (1 ms)\n      ✕ Admin should get memberships by user\n      ✕ User should get their own memberships (1 ms)\n      ✕ Should fail without userId or organizationId\n      ✕ Regular user should fail to get other user memberships\n    Get Membership by ID\n      ✕ Admin should get membership by ID\n      ✕ Should fail with invalid membership ID\n    Update Member Role\n      ✕ Admin should update member role successfully\n      ✕ Should fail with invalid role (1 ms)\n      ✕ Regular user should fail to update role without permissions\n    Remove Member\n      ✕ Admin should remove member successfully\n      ✕ Regular user should fail to remove member without permissions\n    Self-Leave Organization\n      ✕ User should be able to leave organization (remove own membership)\n    Cross-Organization Access Validation\n      ✕ Organization admin should not access memberships from other organizations\n      ✕ Organization admin should not invite users to other organizations\n      ✕ Super admin should access all organizations\n\n  ● Memberships E2E Tests › Invite User to Organization › Admin should invite user to organization successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Invite User to Organization › Should fail to invite same user twice\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Invite User to Organization › Regular user should fail to invite without admin permissions\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Invite User to Organization › Should invite user with different roles\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Get Memberships › Admin should get memberships by organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Get Memberships › Admin should get memberships by user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Get Memberships › User should get their own memberships\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Get Memberships › Should fail without userId or organizationId\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Get Memberships › Regular user should fail to get other user memberships\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Get Membership by ID › Admin should get membership by ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Get Membership by ID › Should fail with invalid membership ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Update Member Role › Admin should update member role successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Update Member Role › Should fail with invalid role\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Update Member Role › Regular user should fail to update role without permissions\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Remove Member › Admin should remove member successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Remove Member › Admin should remove member successfully\n\n    AxiosError: Request failed with status code 500\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at Object.<anonymous> (tests/e2e/memberships.e2e.js:417:34)\n\n  ● Memberships E2E Tests › Remove Member › Regular user should fail to remove member without permissions\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Remove Member › Regular user should fail to remove member without permissions\n\n    AxiosError: Request failed with status code 500\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at Object.<anonymous> (tests/e2e/memberships.e2e.js:417:34)\n\n  ● Memberships E2E Tests › Self-Leave Organization › User should be able to leave organization (remove own membership)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Self-Leave Organization › User should be able to leave organization (remove own membership)\n\n    AxiosError: Request failed with status code 500\n\n      57 |     const testName = getCurrentTestName();\n      58 |     try {\n    > 59 |       const res = await axios[method](...args);\n         |                   ^\n      60 |       const duration = performance.now() - start;\n      61 |       const logEntry = {\n      62 |         testName,\n\n      at settle (node_modules/axios/lib/core/settle.js:19:12)\n      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:599:11)\n      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)\n      at Proxy.requestWrapper.<computed> (tests/e2e/helpers/request.js:59:19)\n      at Object.<anonymous> (tests/e2e/memberships.e2e.js:525:34)\n\n  ● Memberships E2E Tests › Cross-Organization Access Validation › Organization admin should not access memberships from other organizations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Cross-Organization Access Validation › Organization admin should not invite users to other organizations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\n  ● Memberships E2E Tests › Cross-Organization Access Validation › Super admin should access all organizations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      48 |     testOrganization = orgResponse.data;\n      49 |     // Verify default type is set\n    > 50 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      51 |   });\n      52 |\n      53 |   afterAll(async () => {\n\n      at Object.toBe (tests/e2e/memberships.e2e.js:50:35)\n\nTest Suites: 1 failed, 1 total\nTests:       20 failed, 20 total\nSnapshots:   0 total\nTime:        18.944 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/memberships.e2e.js/i.\nTest Suites: 1 failed, 1 total\nTests:       20 failed, 20 total\nSnapshots:   0 total\nTime:        18.972 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/memberships.e2e.js/i.\n",
      "timestamp": "2025-06-05T17:09:56.171Z"
    },
    {
      "suite": "pets",
      "description": "Pet management",
      "file": "pets.e2e.js",
      "success": false,
      "exitCode": 1,
      "duration": 16.109,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: pets\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:09:57 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - PETS\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: pets.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/pets.e2e.js\u001b[0m\n  console.log\n    [Firebase] Usando credenciales: ./config/pet-api-dev-35115-68f396572cad.json\n\n      at Object.log (config/firebase.js:11:13)\n\n  console.log\n    [Firebase] Tipo: service_account Email: firebase-adminsdk-fbsvc@pet-api-dev-35115.iam.gserviceaccount.com\n\n      at Object.log (config/firebase.js:12:13)\n\n  console.log\n    [Firebase] Bucket configurado: pet-api-dev-35115.firebasestorage.app\n\n      at Object.log (config/firebase.js:21:9)\n\n  console.log\n    Firebase Admin Initialized for project: pet-api-dev-35115\n\n      at Object.log (config/firebase.js:30:9)\n\n  console.log\n    Prisma Client initialized for PostgreSQL connection\n\n      at Object.log (config/prisma.js:17:9)\n\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Starting cleanup of test data...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/pets.e2e.js:127:5)\n\n  console.log\n    Cleaned up user: pets-user-1749143400552@test.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Cleaned up user: pets-other-admin-1749143401425@test.com\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Test data cleanup completed\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    [ENHANCED REPORT] Generated: /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/reports/pets.e2e/2025-06-05-1910-pets-tests.md\n\n      at EnhancedReporter.log [as writeReport] (tests/e2e/helpers/report.js:290:13)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n\u001b[31m✗ E2E tests failed with exit code: 1\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST FAILED\u001b[0m\u001b[0m\n============================================================\n\u001b[31m✗ Error: Tests failed with code 1\u001b[0m\n\u001b[31m✗ Total duration: 16.00 seconds\u001b[0m\n\u001b[34mℹ Check detailed reports in tests/e2e/reports/[test-name].e2e/ for more information\u001b[0m\n",
      "stderr": "FAIL tests/e2e/pets.e2e.js (14.153 s)\n  Pets E2E Tests - Comprehensive Test Suite (33 tests)\n    Pet Creation\n      ✕ Admin should create a pet successfully (2 ms)\n      ✕ Regular user should create a pet successfully (1 ms)\n      ✕ Should fail without required fields\n      ✕ Should fail without organization context\n    Pet Retrieval\n      ✕ Should get pet by ID\n      ✕ Should list pets for organization\n      ✕ Should filter pets by species\n      ✕ Should filter pets by status\n      ✕ Should fail with invalid pet ID (1 ms)\n    Pet Updates\n      ✕ Admin should update pet successfully (1 ms)\n      ✕ Regular user should update pet successfully\n      ✕ Should fail with invalid pet ID (1 ms)\n    Pet Deletion\n      ✕ Admin should delete pet successfully\n      ✕ Should fail with invalid pet ID\n    Multitenancy & Permissions\n      ✕ User should only see pets from their organization\n      ✕ User should not access pets from other organizations\n      ✕ User should not update pets from other organizations\n      ✕ User should not delete pets from other organizations\n      ✕ Super admin should access pets from any organization\n      ✕ Public pet browsing - users can view all available pets without organization context\n    Pet Visibility Management\n      ✕ Should create pet with default visibility as visible\n      ✕ Should create pet with explicit visibility setting\n      ✕ Should hide a pet successfully\n      ✕ Should show a hidden pet successfully\n      ✕ Should feature a pet successfully\n      ✕ Should update pet visibility directly via PUT\n      ✕ Should fail with invalid visibility value\n      ✕ Regular user should not access hidden pets in listings\n      ✕ Admin should see hidden pets in listings\n      ✕ Should filter pets by visibility\n      ✕ Should search pets with visibility filtering\n      ✕ Regular user should not see hidden pets in search results\n      ✕ Should demonstrate adopted pet with visible status for 7-day showcase (1 ms)\n      ✕ Should fail visibility actions with invalid pet ID\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Creation › Admin should create a pet successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Creation › Regular user should create a pet successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Creation › Should fail without required fields\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Creation › Should fail without organization context\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Retrieval › Should get pet by ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Retrieval › Should list pets for organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Retrieval › Should filter pets by species\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Retrieval › Should filter pets by status\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Retrieval › Should fail with invalid pet ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Updates › Admin should update pet successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Updates › Regular user should update pet successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Updates › Should fail with invalid pet ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Deletion › Admin should delete pet successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Deletion › Should fail with invalid pet ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › User should only see pets from their organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › User should only see pets from their organization\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      606 |           headers: { \n      607 |             Authorization: `Bearer ${otherOrgAdminToken}`,\n    > 608 |             'X-Organization-Id': otherOrganization.id\n          |                                                    ^\n      609 |           }\n      610 |         }\n      611 |       );\n\n      at Object.id (tests/e2e/pets.e2e.js:608:52)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › User should not access pets from other organizations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › User should not access pets from other organizations\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      606 |           headers: { \n      607 |             Authorization: `Bearer ${otherOrgAdminToken}`,\n    > 608 |             'X-Organization-Id': otherOrganization.id\n          |                                                    ^\n      609 |           }\n      610 |         }\n      611 |       );\n\n      at Object.id (tests/e2e/pets.e2e.js:608:52)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › User should not update pets from other organizations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › User should not update pets from other organizations\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      606 |           headers: { \n      607 |             Authorization: `Bearer ${otherOrgAdminToken}`,\n    > 608 |             'X-Organization-Id': otherOrganization.id\n          |                                                    ^\n      609 |           }\n      610 |         }\n      611 |       );\n\n      at Object.id (tests/e2e/pets.e2e.js:608:52)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › User should not delete pets from other organizations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › User should not delete pets from other organizations\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      606 |           headers: { \n      607 |             Authorization: `Bearer ${otherOrgAdminToken}`,\n    > 608 |             'X-Organization-Id': otherOrganization.id\n          |                                                    ^\n      609 |           }\n      610 |         }\n      611 |       );\n\n      at Object.id (tests/e2e/pets.e2e.js:608:52)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › Super admin should access pets from any organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › Super admin should access pets from any organization\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      606 |           headers: { \n      607 |             Authorization: `Bearer ${otherOrgAdminToken}`,\n    > 608 |             'X-Organization-Id': otherOrganization.id\n          |                                                    ^\n      609 |           }\n      610 |         }\n      611 |       );\n\n      at Object.id (tests/e2e/pets.e2e.js:608:52)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › Public pet browsing - users can view all available pets without organization context\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Multitenancy & Permissions › Public pet browsing - users can view all available pets without organization context\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      606 |           headers: { \n      607 |             Authorization: `Bearer ${otherOrgAdminToken}`,\n    > 608 |             'X-Organization-Id': otherOrganization.id\n          |                                                    ^\n      609 |           }\n      610 |         }\n      611 |       );\n\n      at Object.id (tests/e2e/pets.e2e.js:608:52)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should create pet with default visibility as visible\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should create pet with explicit visibility setting\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should hide a pet successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should show a hidden pet successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should feature a pet successfully\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should update pet visibility directly via PUT\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should fail with invalid visibility value\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Regular user should not access hidden pets in listings\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Admin should see hidden pets in listings\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should filter pets by visibility\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should search pets with visibility filtering\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Regular user should not see hidden pets in search results\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should demonstrate adopted pet with visible status for 7-day showcase\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\n  ● Pets E2E Tests - Comprehensive Test Suite (33 tests) › Pet Visibility Management › Should fail visibility actions with invalid pet ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |     testOrganizations.push(testOrganization);\n      64 |     // Verify default type is set\n    > 65 |     expect(testOrganization.type).toBe('shelter');\n         |                                   ^\n      66 |\n      67 |     const otherOrgResponse = await axios.post(\n      68 |       'http://localhost:3000/api/organizations',\n\n      at Object.toBe (tests/e2e/pets.e2e.js:65:35)\n\nTest Suites: 1 failed, 1 total\nTests:       34 failed, 34 total\nSnapshots:   0 total\nTime:        14.299 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/pets.e2e.js/i.\nTest Suites: 1 failed, 1 total\nTests:       34 failed, 34 total\nSnapshots:   0 total\nTime:        14.323 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/pets.e2e.js/i.\n",
      "timestamp": "2025-06-05T17:10:13.281Z"
    },
    {
      "suite": "conversations",
      "description": "Conversation system",
      "file": "conversations.e2e.js",
      "success": false,
      "exitCode": 1,
      "duration": 4.544,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: conversations\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:10:14 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - CONVERSATIONS\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: conversations.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/conversations.e2e.js\u001b[0m\n  console.log\n    [Firebase] Usando credenciales: ./config/pet-api-dev-35115-68f396572cad.json\n\n      at Object.log (config/firebase.js:11:13)\n\n  console.log\n    [Firebase] Tipo: service_account Email: firebase-adminsdk-fbsvc@pet-api-dev-35115.iam.gserviceaccount.com\n\n      at Object.log (config/firebase.js:12:13)\n\n  console.log\n    [Firebase] Bucket configurado: pet-api-dev-35115.firebasestorage.app\n\n      at Object.log (config/firebase.js:21:9)\n\n  console.log\n    Firebase Admin Initialized for project: pet-api-dev-35115\n\n      at Object.log (config/firebase.js:30:9)\n\n  console.log\n    Prisma Client initialized for PostgreSQL connection\n\n      at Object.log (config/prisma.js:17:9)\n\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    \n    🚀 Starting Conversations E2E Tests...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    \n    1️⃣ Authenticating as admin...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    \n    2️⃣ Creating test organization...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.error\n    ❌ Setup failed: expect(received).toBe(expected) // Object.is equality\n    \n    Expected: \"shelter\"\n    Received: undefined\n\n      43 |     console.error = (...args) => {\n      44 |       this.consoleOutput.push({ type: 'error', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 45 |       this.originalConsoleError(...args);\n         |            ^\n      46 |     };\n      47 |   }\n      48 |\n\n      at Object.originalConsoleError [as error] (tests/e2e/helpers/report.js:45:12)\n      at Object.error (tests/e2e/conversations.e2e.js:174:15)\n\n  console.log\n    \n    🧹 Cleaning up test data...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Starting cleanup of test data...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/conversations.e2e.js:207:7)\n\n  console.log\n    Test data cleanup completed\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    [ENHANCED REPORT] Generated: /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/reports/conversations.e2e/2025-06-05-1910-conversations-tests.md\n\n      at EnhancedReporter.log [as writeReport] (tests/e2e/helpers/report.js:290:13)\n\n  console.log\n    ✅ Cleanup completed and report generated!\n\n      at Object.log (tests/e2e/conversations.e2e.js:217:15)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n\u001b[31m✗ E2E tests failed with exit code: 1\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST FAILED\u001b[0m\u001b[0m\n============================================================\n\u001b[31m✗ Error: Tests failed with code 1\u001b[0m\n\u001b[31m✗ Total duration: 4.42 seconds\u001b[0m\n\u001b[34mℹ Check detailed reports in tests/e2e/reports/[test-name].e2e/ for more information\u001b[0m\n",
      "stderr": "FAIL tests/e2e/conversations.e2e.js\n  Conversations E2E Tests - Comprehensive Test Suite (25 tests)\n    Conversation Creation\n      ✕ Should create a conversation with valid participants (1 ms)\n      ✕ Should fail to create conversation with insufficient participants (1 ms)\n      ✕ Should fail to create conversation without participants array\n      ✕ Should create group conversation with multiple participants\n    Conversation Retrieval\n      ✕ Should get conversation by ID for participant (1 ms)\n      ✕ Should fail to get conversation by ID for non-participant\n      ✕ Should get conversations for user\n      ✕ Should fail to get conversations for other user without permission\n      ✕ Should get conversation with invalid ID format (1 ms)\n    Conversation Management\n      ✕ Should soft delete conversation for user (1 ms)\n      ✕ Should hide conversation for user\n      ✕ Should unhide conversation for user (1 ms)\n      ✕ Should block conversation (moderator)\n      ✕ Should unblock conversation (moderator)\n      ✕ Should fail to block conversation as regular user (1 ms)\n    Admin Operations\n      ✕ Should permanently delete conversation (admin)\n      ✕ Should fail to permanently delete conversation as regular user\n      ✕ Should get all conversations (admin)\n      ✕ Should fail to get all conversations as regular user\n    Multitenancy & Organization Isolation\n      ✕ Should create conversation in specific organization (1 ms)\n      ✕ Should not access conversation from different organization\n      ✕ Should filter conversations by organization\n      ✕ Super admin should access conversations across organizations (1 ms)\n    Error Handling & Edge Cases\n      ✕ Should handle non-existent conversation ID\n      ✕ Should handle unauthorized access\n      ✕ Should handle malformed request data\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Creation › Should create a conversation with valid participants\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Creation › Should fail to create conversation with insufficient participants\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Creation › Should fail to create conversation without participants array\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Creation › Should create group conversation with multiple participants\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Retrieval › Should get conversation by ID for participant\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Retrieval › Should fail to get conversation by ID for non-participant\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Retrieval › Should get conversations for user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Retrieval › Should fail to get conversations for other user without permission\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Retrieval › Should get conversation with invalid ID format\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Management › Should soft delete conversation for user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Management › Should hide conversation for user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Management › Should unhide conversation for user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Management › Should block conversation (moderator)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Management › Should unblock conversation (moderator)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Conversation Management › Should fail to block conversation as regular user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Admin Operations › Should permanently delete conversation (admin)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Admin Operations › Should fail to permanently delete conversation as regular user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Admin Operations › Should get all conversations (admin)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Admin Operations › Should fail to get all conversations as regular user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Multitenancy & Organization Isolation › Should create conversation in specific organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Multitenancy & Organization Isolation › Should not access conversation from different organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Multitenancy & Organization Isolation › Should filter conversations by organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Multitenancy & Organization Isolation › Super admin should access conversations across organizations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Error Handling & Edge Cases › Should handle non-existent conversation ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Error Handling & Edge Cases › Should handle unauthorized access\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\n  ● Conversations E2E Tests - Comprehensive Test Suite (25 tests) › Error Handling & Edge Cases › Should handle malformed request data\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      63 |       testOrganizations.push(testOrganization);\n      64 |       // Verify default type is set\n    > 65 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      66 |\n      67 |       // 3. Create second test organization for multitenancy tests\n      68 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/conversations.e2e.js:65:37)\n\nTest Suites: 1 failed, 1 total\nTests:       26 failed, 26 total\nSnapshots:   0 total\nTime:        2.748 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/conversations.e2e.js/i.\nTest Suites: 1 failed, 1 total\nTests:       26 failed, 26 total\nSnapshots:   0 total\nTime:        2.769 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/conversations.e2e.js/i.\n",
      "timestamp": "2025-06-05T17:10:18.828Z"
    },
    {
      "suite": "messages",
      "description": "Message system",
      "file": "messages.e2e.js",
      "success": false,
      "exitCode": 1,
      "duration": 4.766,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: messages\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:10:19 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - MESSAGES\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: messages.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/messages.e2e.js\u001b[0m\n  console.log\n    [Firebase] Usando credenciales: ./config/pet-api-dev-35115-68f396572cad.json\n\n      at Object.log (config/firebase.js:11:13)\n\n  console.log\n    [Firebase] Tipo: service_account Email: firebase-adminsdk-fbsvc@pet-api-dev-35115.iam.gserviceaccount.com\n\n      at Object.log (config/firebase.js:12:13)\n\n  console.log\n    [Firebase] Bucket configurado: pet-api-dev-35115.firebasestorage.app\n\n      at Object.log (config/firebase.js:21:9)\n\n  console.log\n    Firebase Admin Initialized for project: pet-api-dev-35115\n\n      at Object.log (config/firebase.js:30:9)\n\n  console.log\n    Prisma Client initialized for PostgreSQL connection\n\n      at Object.log (config/prisma.js:17:9)\n\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    \n    🚀 Starting Messages E2E Tests...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    \n    1️⃣ Authenticating as admin...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    \n    2️⃣ Creating test organization...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.error\n    ❌ Setup failed: expect(received).toBe(expected) // Object.is equality\n    \n    Expected: \"shelter\"\n    Received: undefined\n\n      43 |     console.error = (...args) => {\n      44 |       this.consoleOutput.push({ type: 'error', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 45 |       this.originalConsoleError(...args);\n         |            ^\n      46 |     };\n      47 |   }\n      48 |\n\n      at Object.originalConsoleError [as error] (tests/e2e/helpers/report.js:45:12)\n      at Object.error (tests/e2e/messages.e2e.js:224:15)\n\n  console.log\n    \n    🧹 Cleaning up test data...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    Starting cleanup of test data...\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.warn\n    Error cleaning up organization undefined: {\n      error: 'Invalid organization ID',\n      details: [ 'Organization ID must be a valid UUID' ]\n    }\n\n      38 |     console.warn = (...args) => {\n      39 |       this.consoleOutput.push({ type: 'warn', message: args.join(' '), timestamp: new Date().toISOString() });\n    > 40 |       this.originalConsoleWarn(...args);\n         |            ^\n      41 |     };\n      42 |     \n      43 |     console.error = (...args) => {\n\n      at Object.originalConsoleWarn [as warn] (tests/e2e/helpers/report.js:40:12)\n      at warn (tests/e2e/helpers/auth.js:143:15)\n      at Object.<anonymous> (tests/e2e/messages.e2e.js:258:7)\n\n  console.log\n    Test data cleanup completed\n\n      at Object.originalConsoleLog [as log] (tests/e2e/helpers/report.js:35:12)\n\n  console.log\n    [ENHANCED REPORT] Generated: /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/reports/messages.e2e/2025-06-05-1910-messages-tests.md\n\n      at EnhancedReporter.log [as writeReport] (tests/e2e/helpers/report.js:290:13)\n\n  console.log\n    ✅ Cleanup completed and report generated!\n\n      at Object.log (tests/e2e/messages.e2e.js:268:15)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n-------------|---------|----------|---------|---------|-------------------\nFile         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------|---------|----------|---------|---------|-------------------\nAll files    |   77.41 |    35.71 |       0 |   77.41 |                   \n firebase.js |   88.23 |       50 |     100 |   88.23 | 14-17             \n prisma.js   |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33    \n-------------|---------|----------|---------|---------|-------------------\n\u001b[31m✗ E2E tests failed with exit code: 1\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST FAILED\u001b[0m\u001b[0m\n============================================================\n\u001b[31m✗ Error: Tests failed with code 1\u001b[0m\n\u001b[31m✗ Total duration: 4.67 seconds\u001b[0m\n\u001b[34mℹ Check detailed reports in tests/e2e/reports/[test-name].e2e/ for more information\u001b[0m\n",
      "stderr": "FAIL tests/e2e/messages.e2e.js\n  Messages E2E Tests - Comprehensive Test Suite (28 tests)\n    Message Creation\n      ✕ Should create a message with valid content (2 ms)\n      ✕ Should create a message with attachments\n      ✕ Should fail to create message without conversation ID (1 ms)\n      ✕ Should fail to create message without content or attachments\n      ✕ Should fail to create message in non-existent conversation (1 ms)\n      ✕ Should fail to create message as non-participant\n    Message Retrieval\n      ✕ Should get messages by conversation ID\n      ✕ Should get message by ID\n      ✕ Should fail to get message by invalid ID format\n      ✕ Should fail to get non-existent message\n      ✕ Should fail to get messages from conversation as non-participant\n      ✕ Should get messages with filters (admin)\n    Message Permissions\n      ✕ Should allow message sender to view their message\n      ✕ Should allow conversation participant to view message\n      ✕ Should fail to view message as non-participant\n    Message Deletion\n      ✕ Should allow message sender to delete their own message\n      ✕ Should allow admin to delete any message\n      ✕ Should fail to delete message as non-sender non-admin (1 ms)\n      ✕ Should fail to delete non-existent message\n    Multitenancy & Organization Isolation\n      ✕ Should create message in specific organization\n      ✕ Should not access messages from different organization\n      ✕ Should filter messages by organization\n      ✕ Super admin should access messages across organizations\n    Error Handling & Edge Cases\n      ✕ Should handle unauthorized access\n      ✕ Should handle malformed message data\n      ✕ Should handle invalid message ID format in deletion (1 ms)\n      ✕ Should handle message creation with location data\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Creation › Should create a message with valid content\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Creation › Should create a message with attachments\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Creation › Should fail to create message without conversation ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Creation › Should fail to create message without content or attachments\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Creation › Should fail to create message in non-existent conversation\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Creation › Should fail to create message as non-participant\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Retrieval › Should get messages by conversation ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Retrieval › Should get message by ID\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Retrieval › Should fail to get message by invalid ID format\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Retrieval › Should fail to get non-existent message\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Retrieval › Should fail to get messages from conversation as non-participant\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Retrieval › Should get messages with filters (admin)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Permissions › Should allow message sender to view their message\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Permissions › Should allow conversation participant to view message\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Permissions › Should fail to view message as non-participant\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Deletion › Should allow message sender to delete their own message\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Deletion › Should allow admin to delete any message\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Deletion › Should fail to delete message as non-sender non-admin\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Message Deletion › Should fail to delete non-existent message\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Multitenancy & Organization Isolation › Should create message in specific organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Multitenancy & Organization Isolation › Should not access messages from different organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Multitenancy & Organization Isolation › Should filter messages by organization\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Multitenancy & Organization Isolation › Super admin should access messages across organizations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Error Handling & Edge Cases › Should handle unauthorized access\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Error Handling & Edge Cases › Should handle malformed message data\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Error Handling & Edge Cases › Should handle invalid message ID format in deletion\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\n  ● Messages E2E Tests - Comprehensive Test Suite (28 tests) › Error Handling & Edge Cases › Should handle message creation with location data\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"shelter\"\n    Received: undefined\n\n      68 |       testOrganizations.push(testOrganization);\n      69 |       // Verify default type is set\n    > 70 |       expect(testOrganization.type).toBe('shelter');\n         |                                     ^\n      71 |\n      72 |       // 3. Create second test organization for multitenancy tests\n      73 |       console.log('\\n3️⃣ Creating second test organization...');\n\n      at Object.toBe (tests/e2e/messages.e2e.js:70:37)\n\nTest Suites: 1 failed, 1 total\nTests:       27 failed, 27 total\nSnapshots:   0 total\nTime:        2.974 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/messages.e2e.js/i.\nTest Suites: 1 failed, 1 total\nTests:       27 failed, 27 total\nSnapshots:   0 total\nTime:        2.996 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/messages.e2e.js/i.\n",
      "timestamp": "2025-06-05T17:10:24.595Z"
    },
    {
      "suite": "i18n",
      "description": "Internationalization system",
      "file": "i18n-system.e2e.js",
      "success": false,
      "exitCode": 1,
      "duration": 6.379,
      "stdout": "\n============================================================\n\u001b[36m\u001b[1m  E2E DEVELOPMENT TESTING\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Test Suite: i18n\u001b[0m\n\u001b[34mℹ Start Time: 6/5/2025, 7:10:25 PM\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  CHECKING ENVIRONMENT\u001b[0m\u001b[0m\n============================================================\n\u001b[32m✓ All required environment variables are set\u001b[0m\n\u001b[34mℹ Database URL: postgresql://postgres:aKEXfOPoMmjNIvsTsBUqunhsKePI...\u001b[0m\n\u001b[34mℹ API URL: http://localhost:3000/api\u001b[0m\n\u001b[32m✓ All test files are present\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  RUNNING E2E TESTS - I18N\u001b[0m\u001b[0m\n============================================================\n\u001b[34mℹ Running tests: i18n-system.e2e.js\u001b[0m\n\u001b[34mℹ Jest command: npx jest --config jest.e2e.config.js --detectOpenHandles --forceExit --verbose --testTimeout=30000 /Users/daniellovazzano/Documents/Projects/pet-api-firebase/backend/tests/e2e/i18n-system.e2e.js\u001b[0m\n  console.log\n    [config] Variables de entorno cargadas desde .env.dev\n\n      at log (config/loadEnv.js:22:15)\n\n  console.log\n    [Firebase] Usando credenciales: ./config/pet-api-dev-35115-68f396572cad.json\n\n      at Object.log (config/firebase.js:11:13)\n\n  console.log\n    [Firebase] Tipo: service_account Email: firebase-adminsdk-fbsvc@pet-api-dev-35115.iam.gserviceaccount.com\n\n      at Object.log (config/firebase.js:12:13)\n\n  console.log\n    [Firebase] Bucket configurado: pet-api-dev-35115.firebasestorage.app\n\n      at Object.log (config/firebase.js:21:9)\n\n  console.log\n    Firebase Admin Initialized for project: pet-api-dev-35115\n\n      at Object.log (config/firebase.js:30:9)\n\n  console.log\n    [i18n] Loaded language: en with 11 namespaces\n\n      at I18nManager.log [as loadLanguage] (utils/i18n.js:57:15)\n\n  console.log\n    Prisma Client initialized for PostgreSQL connection\n\n      at Object.log (config/prisma.js:17:9)\n\n  console.log\n    === ADMIN CONTROLLER CARGADO ===\n\n      at Object.log (controllers/adminController.js:1:9)\n\n  console.log\n    [StorageUtils] Inicializando Google Cloud Storage con: ./config/pet-api-dev-35115-68f396572cad.json Bucket: pet-api-dev-35115.firebasestorage.app\n\n      at Object.log (utils/storageUtils.js:8:9)\n\n  console.log\n    \n    🔧 Setting up test environment...\n\n      at Object.log (tests/e2e/setup.js:13:11)\n\n  console.log\n    📡 Using API: http://localhost:3000/api\n\n      at Object.log (tests/e2e/setup.js:14:11)\n\n  console.log\n    🗄️ Database: Connected\n\n      at Object.log (tests/e2e/setup.js:15:11)\n\n  console.log\n    Setting up i18n E2E test environment...\n\n      at Object.log (tests/e2e/i18n-system.e2e.js:19:13)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Loaded language: es with 11 namespaces\n\n      at I18nManager.log [as loadLanguage] (utils/i18n.js:57:15)\n\n  console.log\n    [i18n] Language detected: es (source: header)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: en (source: fallback)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.warn\n    [i18n] Missing translation key: \"non.existent.key\" for language: \"es\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at Object.translate (tests/e2e/i18n-system.e2e.js:75:27)\n\n  console.log\n    [i18n] Language detected: en (source: fallback)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: en (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: en (source: fallback)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.error\n    [auth] Token no proporcionado o mal formado: undefined\n\n       9 |\n      10 |   if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    > 11 |     console.error('[auth] Token no proporcionado o mal formado:', authHeader);\n         |             ^\n      12 |     return res.status(401).json({ error: 'Token no proporcionado' });\n      13 |   }\n      14 |\n\n      at error (middlewares/auth.js:11:13)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/express/lib/router/index.js:646:15\n      at next (node_modules/express/lib/router/index.js:265:14)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at router (node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:225:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/responseFormatter.js:130:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:171:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at cors (node_modules/cors/lib/index.js:188:7)\n      at node_modules/cors/lib/index.js:224:17\n      at originCallback (node_modules/cors/lib/index.js:214:15)\n      at node_modules/cors/lib/index.js:219:13\n      at optionsCallback (node_modules/cors/lib/index.js:199:9)\n      at corsMiddleware (node_modules/cors/lib/index.js:204:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at expressInit (node_modules/express/lib/middleware/init.js:40:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at query (node_modules/express/lib/middleware/query.js:45:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at Function.handle (node_modules/express/lib/application.js:181:10)\n      at Server.app (node_modules/express/lib/express.js:39:9)\n\n  console.log\n    [i18n] Language detected: en (source: fallback)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.error\n    [auth] Token no proporcionado o mal formado: undefined\n\n       9 |\n      10 |   if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    > 11 |     console.error('[auth] Token no proporcionado o mal formado:', authHeader);\n         |             ^\n      12 |     return res.status(401).json({ error: 'Token no proporcionado' });\n      13 |   }\n      14 |\n\n      at error (middlewares/auth.js:11:13)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/express/lib/router/index.js:646:15\n      at next (node_modules/express/lib/router/index.js:265:14)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at router (node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:225:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/responseFormatter.js:130:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:171:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/body-parser/lib/read.js:137:5\n      at invokeCallback (node_modules/raw-body/index.js:238:16)\n      at done (node_modules/raw-body/index.js:227:7)\n      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)\n\n  console.log\n    [i18n] Language detected: en (source: fallback)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.error\n    [auth] Token no proporcionado o mal formado: undefined\n\n       9 |\n      10 |   if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    > 11 |     console.error('[auth] Token no proporcionado o mal formado:', authHeader);\n         |             ^\n      12 |     return res.status(401).json({ error: 'Token no proporcionado' });\n      13 |   }\n      14 |\n\n      at error (middlewares/auth.js:11:13)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/express/lib/router/index.js:646:15\n      at next (node_modules/express/lib/router/index.js:265:14)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at router (node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:225:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/responseFormatter.js:130:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:171:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/body-parser/lib/read.js:137:5\n      at invokeCallback (node_modules/raw-body/index.js:238:16)\n      at done (node_modules/raw-body/index.js:227:7)\n      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)\n\n  console.log\n    [i18n] Language detected: en (source: fallback)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.error\n    [auth] Token no proporcionado o mal formado: undefined\n\n       9 |\n      10 |   if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    > 11 |     console.error('[auth] Token no proporcionado o mal formado:', authHeader);\n         |             ^\n      12 |     return res.status(401).json({ error: 'Token no proporcionado' });\n      13 |   }\n      14 |\n\n      at error (middlewares/auth.js:11:13)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/express/lib/router/index.js:646:15\n      at next (node_modules/express/lib/router/index.js:265:14)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at router (node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:225:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/responseFormatter.js:130:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:171:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at cors (node_modules/cors/lib/index.js:188:7)\n      at node_modules/cors/lib/index.js:224:17\n      at originCallback (node_modules/cors/lib/index.js:214:15)\n      at node_modules/cors/lib/index.js:219:13\n      at optionsCallback (node_modules/cors/lib/index.js:199:9)\n      at corsMiddleware (node_modules/cors/lib/index.js:204:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at expressInit (node_modules/express/lib/middleware/init.js:40:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at query (node_modules/express/lib/middleware/query.js:45:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at Function.handle (node_modules/express/lib/application.js:181:10)\n      at Server.app (node_modules/express/lib/express.js:39:9)\n\n  console.log\n    [i18n] Language detected: en (source: fallback)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.error\n    [auth] Token no proporcionado o mal formado: undefined\n\n       9 |\n      10 |   if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    > 11 |     console.error('[auth] Token no proporcionado o mal formado:', authHeader);\n         |             ^\n      12 |     return res.status(401).json({ error: 'Token no proporcionado' });\n      13 |   }\n      14 |\n\n      at error (middlewares/auth.js:11:13)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/express/lib/router/index.js:646:15\n      at next (node_modules/express/lib/router/index.js:265:14)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at router (node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:225:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/responseFormatter.js:130:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:171:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/body-parser/lib/read.js:137:5\n      at invokeCallback (node_modules/raw-body/index.js:238:16)\n      at done (node_modules/raw-body/index.js:227:7)\n      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)\n\n  console.log\n    [i18n] Language detected: en (source: fallback)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.error\n    [auth] Token no proporcionado o mal formado: undefined\n\n       9 |\n      10 |   if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    > 11 |     console.error('[auth] Token no proporcionado o mal formado:', authHeader);\n         |             ^\n      12 |     return res.status(401).json({ error: 'Token no proporcionado' });\n      13 |   }\n      14 |\n\n      at error (middlewares/auth.js:11:13)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/express/lib/router/index.js:646:15\n      at next (node_modules/express/lib/router/index.js:265:14)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at router (node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:225:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/responseFormatter.js:130:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:171:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at cors (node_modules/cors/lib/index.js:188:7)\n      at node_modules/cors/lib/index.js:224:17\n      at originCallback (node_modules/cors/lib/index.js:214:15)\n      at node_modules/cors/lib/index.js:219:13\n      at optionsCallback (node_modules/cors/lib/index.js:199:9)\n      at corsMiddleware (node_modules/cors/lib/index.js:204:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at expressInit (node_modules/express/lib/middleware/init.js:40:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at query (node_modules/express/lib/middleware/query.js:45:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at Function.handle (node_modules/express/lib/application.js:181:10)\n      at Server.app (node_modules/express/lib/express.js:39:9)\n\n  console.log\n    [i18n] Language detected: en (source: header)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: es (source: header)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: es (source: header)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: en (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: en (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: en (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: en (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: en (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.warn\n    [i18n] Missing translation key: \"non.existent.key\" for language: \"en\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at Object.translate (tests/e2e/i18n-system.e2e.js:263:27)\n\n  console.log\n    [i18n] Language detected: en (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.error\n    [auth] Token no proporcionado o mal formado: undefined\n\n       9 |\n      10 |   if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    > 11 |     console.error('[auth] Token no proporcionado o mal formado:', authHeader);\n         |             ^\n      12 |     return res.status(401).json({ error: 'Token no proporcionado' });\n      13 |   }\n      14 |\n\n      at error (middlewares/auth.js:11:13)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/express/lib/router/index.js:646:15\n      at next (node_modules/express/lib/router/index.js:265:14)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at router (node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:225:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/responseFormatter.js:130:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:171:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at cors (node_modules/cors/lib/index.js:188:7)\n      at node_modules/cors/lib/index.js:224:17\n      at originCallback (node_modules/cors/lib/index.js:214:15)\n      at node_modules/cors/lib/index.js:219:13\n      at optionsCallback (node_modules/cors/lib/index.js:199:9)\n      at corsMiddleware (node_modules/cors/lib/index.js:204:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at expressInit (node_modules/express/lib/middleware/init.js:40:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at query (node_modules/express/lib/middleware/query.js:45:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at Function.handle (node_modules/express/lib/application.js:181:10)\n      at Server.app (node_modules/express/lib/express.js:39:9)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.error\n    [auth] Token no proporcionado o mal formado: undefined\n\n       9 |\n      10 |   if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    > 11 |     console.error('[auth] Token no proporcionado o mal formado:', authHeader);\n         |             ^\n      12 |     return res.status(401).json({ error: 'Token no proporcionado' });\n      13 |   }\n      14 |\n\n      at error (middlewares/auth.js:11:13)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at node_modules/express/lib/router/index.js:646:15\n      at next (node_modules/express/lib/router/index.js:265:14)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at router (node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:225:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/responseFormatter.js:130:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at next (middlewares/languageDetection.js:171:3)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at cors (node_modules/cors/lib/index.js:188:7)\n      at node_modules/cors/lib/index.js:224:17\n      at originCallback (node_modules/cors/lib/index.js:214:15)\n      at node_modules/cors/lib/index.js:219:13\n      at optionsCallback (node_modules/cors/lib/index.js:199:9)\n      at corsMiddleware (node_modules/cors/lib/index.js:204:7)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at expressInit (node_modules/express/lib/middleware/init.js:40:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at query (node_modules/express/lib/middleware/query.js:45:5)\n      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (node_modules/express/lib/router/index.js:328:13)\n      at node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (node_modules/express/lib/router/index.js:346:12)\n      at next (node_modules/express/lib/router/index.js:280:10)\n      at Function.handle (node_modules/express/lib/router/index.js:175:3)\n      at Function.handle (node_modules/express/lib/application.js:181:10)\n      at Server.app (node_modules/express/lib/express.js:39:9)\n\n  console.warn\n    [i18n] Missing translation key: \"admin.not_found\" for language: \"en\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at translate (tests/e2e/i18n-system.e2e.js:296:31)\n          at Array.forEach (<anonymous>)\n      at Object.forEach (tests/e2e/i18n-system.e2e.js:294:18)\n\n  console.warn\n    [i18n] Missing translation key: \"admin.not_found\" for language: \"es\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at translate (tests/e2e/i18n-system.e2e.js:297:31)\n          at Array.forEach (<anonymous>)\n      at Object.forEach (tests/e2e/i18n-system.e2e.js:294:18)\n\n  console.warn\n    [i18n] Missing translation key: \"auth.not_found\" for language: \"en\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at translate (tests/e2e/i18n-system.e2e.js:296:31)\n          at Array.forEach (<anonymous>)\n      at Object.forEach (tests/e2e/i18n-system.e2e.js:294:18)\n\n  console.warn\n    [i18n] Missing translation key: \"auth.not_found\" for language: \"es\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at translate (tests/e2e/i18n-system.e2e.js:297:31)\n          at Array.forEach (<anonymous>)\n      at Object.forEach (tests/e2e/i18n-system.e2e.js:294:18)\n\n  console.warn\n    [i18n] Missing translation key: \"errors.not_found\" for language: \"en\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at translate (tests/e2e/i18n-system.e2e.js:296:31)\n          at Array.forEach (<anonymous>)\n      at Object.forEach (tests/e2e/i18n-system.e2e.js:294:18)\n\n  console.warn\n    [i18n] Missing translation key: \"errors.not_found\" for language: \"es\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at translate (tests/e2e/i18n-system.e2e.js:297:31)\n          at Array.forEach (<anonymous>)\n      at Object.forEach (tests/e2e/i18n-system.e2e.js:294:18)\n\n  console.warn\n    [i18n] Missing translation key: \"validation.not_found\" for language: \"en\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at translate (tests/e2e/i18n-system.e2e.js:296:31)\n          at Array.forEach (<anonymous>)\n      at Object.forEach (tests/e2e/i18n-system.e2e.js:294:18)\n\n  console.warn\n    [i18n] Missing translation key: \"validation.not_found\" for language: \"es\"\n\n      182 |\n      183 |     if (i18nConfig.development.logMissingKeys) {\n    > 184 |       console.warn(`[i18n] Missing translation key: \"${key}\" for language: \"${language}\"`);\n          |               ^\n      185 |     }\n      186 |   }\n      187 |\n\n      at I18nManager.warn [as registerMissingKey] (utils/i18n.js:184:15)\n      at I18nManager.registerMissingKey [as getTranslation] (utils/i18n.js:92:12)\n      at getTranslation (utils/i18n.js:252:22)\n      at translate (tests/e2e/i18n-system.e2e.js:297:31)\n          at Array.forEach (<anonymous>)\n      at Object.forEach (tests/e2e/i18n-system.e2e.js:294:18)\n\n  console.log\n    [i18n] Language detected: es (source: querystring)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    [i18n] Language detected: en (source: fallback)\n\n      at log (middlewares/languageDetection.js:168:13)\n\n  console.log\n    Cleaning up i18n E2E test environment...\n\n      at Object.log (tests/e2e/i18n-system.e2e.js:24:13)\n\n  console.log\n    \n    🧹 Cleaning up test environment...\n\n      at Object.log (tests/e2e/setup.js:21:11)\n\n-----------------------------------|---------|----------|---------|---------|--------------------------------------------------------------------------------------------------------\nFile                               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                      \n-----------------------------------|---------|----------|---------|---------|--------------------------------------------------------------------------------------------------------\nAll files                          |   20.57 |     6.02 |   10.03 |   20.91 |                                                                                                        \n backend                           |      95 |        0 |       0 |      95 |                                                                                                        \n  app.js                           |      95 |        0 |       0 |      95 | 64-65                                                                                                  \n backend/config                    |   64.19 |    26.08 |    9.09 |   64.19 |                                                                                                        \n  firebase.js                      |   88.23 |       50 |     100 |   88.23 | 14-17                                                                                                  \n  i18n.js                          |     100 |      100 |     100 |     100 |                                                                                                        \n  loadEnv.js                       |    87.5 |       70 |     100 |    87.5 | 29-30                                                                                                  \n  organizationTypes.js             |   31.03 |        0 |       0 |   31.03 | 60,69,78-81,89,98-99,108-109,119-139                                                                   \n  permissionRules.js               |     100 |      100 |     100 |     100 |                                                                                                        \n  prisma.js                        |   64.28 |    16.66 |       0 |   64.28 | 21-22,27,32-33                                                                                         \n backend/controllers               |    6.98 |     0.24 |    2.41 |     7.1 |                                                                                                        \n  adminController.js               |    5.76 |        0 |       0 |    5.94 | 7-106,112-133,139-269,275-313,319-342,348-382,388-415,421-452,458-493                                  \n  authController.js                |    6.04 |     2.56 |   14.28 |    6.07 | 8-12,19-173,189-427                                                                                    \n  conversationController.js        |    5.31 |        0 |       0 |    5.41 | 5-49,54-90,95-151,156-187,192-272,276-300,306-330,336-360,366-390,396-415                              \n  languagePreferencesController.js |   20.28 |        0 |   16.66 |   20.28 | 8-25,33-56,64-95,103-140,170-171,179-210                                                               \n  membershipController.js          |     5.5 |        0 |       0 |     5.5 | 5-85,91-134,139-173,177-217,221-256                                                                    \n  messageController.js             |    5.71 |        0 |       0 |    5.76 | 5-47,52-81,86-126,131-171,176-235                                                                      \n  organizationController.js        |    9.43 |        0 |       0 |    9.52 | 11-31,36-68,74-108,114-139,145-163,169-200,209-213,221-230                                             \n  petController.js                 |    6.85 |        0 |       0 |    7.14 | 14-154,170-201,206-222,227-279,284-294,310-338,343-374,379-409,414-424,429-472,482-492,502-512,522-532 \n  userController.js                |    6.52 |        0 |       0 |    6.59 | 8-83,88-131,135-183,187-229,235-262,268-290,297-319,326-349,355-400,405-420                            \n backend/middlewares               |   33.73 |    21.45 |   31.37 |   33.49 |                                                                                                        \n  auth.js                          |   23.52 |     12.5 |   33.33 |   23.52 | 15-41,47-71                                                                                            \n  authentication.js                |      10 |        0 |       0 |      10 | 47-149                                                                                                 \n  authorization.js                 |   18.75 |       16 |      50 |   18.75 | 39,44-136                                                                                              \n  index.js                         |   61.29 |    29.41 |      50 |   61.29 | 72-79,93-121,137,152,204,234                                                                           \n  languageDetection.js             |   62.74 |    52.17 |   53.84 |   63.91 | 30-38,44-52,101-110,118-127,147-148,179-184,198-208                                                    \n  organizationContext.js           |    12.5 |        0 |       0 |    12.5 | 15-60                                                                                                  \n  resourceLoaders.js               |    8.57 |        0 |       0 |    8.57 | 47-70,80-112,122-148,158-192,201-227,236-263,292-324                                                   \n  responseFormatter.js             |   57.44 |    15.38 |   26.66 |   56.52 | 10-22,27-39,81-87,92,97,102,107,112,117,122,127                                                        \n backend/middlewares/validation    |   14.94 |        0 |       0 |   14.94 |                                                                                                        \n  organizationValidation.js        |      14 |        0 |       0 |      14 | 24-65,88-133,145-152,162-177,193-223                                                                   \n  petValidation.js                 |   16.21 |        0 |       0 |   16.21 | 49-66,115-133,148-158,172-182,193-243                                                                  \n backend/models                    |     100 |      100 |     100 |     100 |                                                                                                        \n  adapter.js                       |     100 |      100 |     100 |     100 |                                                                                                        \n backend/models/prisma             |    9.58 |     0.75 |    1.26 |      10 |                                                                                                        \n  conversationModel.js             |   11.38 |        0 |       0 |   11.96 | 21-65,75-105,116-157,167-226,237-265,275-289,300-328,339-367,378-406,417-445                           \n  membershipModel.js               |   16.92 |        0 |       0 |   16.92 | 17-49,59-71,82-94,104-112,124-145,156-171,181-189,199-207                                              \n  messageModel.js                  |   15.25 |        0 |       0 |   15.25 | 21-65,75-84,94-102,112-159,169-185                                                                     \n  organizationModel.js             |    9.09 |     2.77 |    9.09 |    9.73 | 22-27,46-91,106-332                                                                                    \n  petModel.js                      |      10 |        0 |       0 |   10.82 | 24-66,75-116,126-131,145-169,183-232,242-248,259-268,279-296,306-313,323-328,337-348,358-364           \n  userModel.js                     |     3.1 |     1.03 |       0 |    3.14 | 14-19,33-611                                                                                           \n backend/routes                    |     100 |      100 |     100 |     100 |                                                                                                        \n  adminRoutes.js                   |     100 |      100 |     100 |     100 |                                                                                                        \n  authRoutes.js                    |     100 |      100 |     100 |     100 |                                                                                                        \n  conversationRoutes.js            |     100 |      100 |     100 |     100 |                                                                                                        \n  languagePreferencesRoutes.js     |     100 |      100 |     100 |     100 |                                                                                                        \n  membershipRoutes.js              |     100 |      100 |     100 |     100 |                                                                                                        \n  messageRoutes.js                 |     100 |      100 |     100 |     100 |                                                                                                        \n  organizationRoutes.js            |     100 |      100 |     100 |     100 |                                                                                                        \n  petRoutes.js                     |     100 |      100 |     100 |     100 |                                                                                                        \n  publicLanguageRoutes.js          |     100 |      100 |     100 |     100 |                                                                                                        \n  userRoutes.js                    |     100 |      100 |     100 |     100 |                                                                                                        \n backend/services                  |    3.57 |        0 |       0 |    3.66 |                                                                                                        \n  permissionService.js             |    3.57 |        0 |       0 |    3.66 | 20-426                                                                                                 \n backend/utils                     |   57.03 |    47.29 |   57.14 |   57.89 |                                                                                                        \n  i18n.js                          |   76.47 |    73.91 |   70.58 |   77.38 | 25,32-33,49,59,85,148-150,193-220                                                                      \n  imageUtils.js                    |    9.52 |        0 |       0 |    9.52 | 15-55                                                                                                  \n  loggerUtil.js                    |   22.22 |        0 |       0 |   22.22 | 15-31                                                                                                  \n  storageUtils.js                  |      40 |     12.5 |       0 |    42.1 | 19-46                                                                                                  \n-----------------------------------|---------|----------|---------|---------|--------------------------------------------------------------------------------------------------------\n\u001b[31m✗ E2E tests failed with exit code: 1\u001b[0m\n\n============================================================\n\u001b[36m\u001b[1m  TEST FAILED\u001b[0m\u001b[0m\n============================================================\n\u001b[31m✗ Error: Tests failed with code 1\u001b[0m\n\u001b[31m✗ Total duration: 6.29 seconds\u001b[0m\n\u001b[34mℹ Check detailed reports in tests/e2e/reports/[test-name].e2e/ for more information\u001b[0m\n",
      "stderr": "FAIL tests/e2e/i18n-system.e2e.js\n  i18n System E2E Tests\n    Language Detection Flow\n      ✓ should detect language from query parameter (159 ms)\n      ✓ should detect language from Accept-Language header (20 ms)\n      ✓ should fallback to default language when no preference is found (24 ms)\n    Translation System\n      ✓ should return translations in English (1 ms)\n      ✓ should return translations in Spanish (2 ms)\n      ✓ should handle parameter interpolation (2 ms)\n      ✓ should fallback to English for missing Spanish translations (5 ms)\n    Supported Languages API\n      ✓ should return supported languages information (27 ms)\n      ✓ should return language names in different languages (48 ms)\n    User Language Preferences\n      ✕ should get user language preference (requires auth) (35 ms)\n      ✕ should update user language preference (requires auth) (42 ms)\n      ✕ should validate language preference input (28 ms)\n    Organization Language Preferences\n      ✕ should get organization language preference (requires auth) (26 ms)\n      ✕ should update organization language preference (requires auth) (24 ms)\n    Language Statistics API\n      ✕ should require admin permissions for statistics (23 ms)\n    i18n Integration with Controllers\n      ✓ should return translated messages from auth endpoints (36 ms)\n      ✓ should maintain language consistency across requests (32 ms)\n    Performance Tests\n      ✓ should load translations efficiently (1 ms)\n      ✓ should handle concurrent language detection efficiently (146 ms)\n    Error Handling\n      ✓ should handle missing translation keys gracefully (3 ms)\n      ✓ should handle invalid language codes gracefully (1 ms)\n      ✓ should return error messages in correct language (50 ms)\n    Namespace Coverage\n      ✓ should have translations for all namespaces (19 ms)\n    Integration with Middleware\n      ✓ should add correct headers to responses (16 ms)\n      ✓ should format responses correctly (19 ms)\n\n  ● i18n System E2E Tests › User Language Preferences › should get user language preference (requires auth)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: undefined\n\n      120 |         .expect(401); // Expect unauthorized without auth\n      121 |\n    > 122 |       expect(response.body.success).toBe(false);\n          |                                     ^\n      123 |     });\n      124 |\n      125 |     test('should update user language preference (requires auth)', async () => {\n\n      at Object.toBe (tests/e2e/i18n-system.e2e.js:122:37)\n\n  ● i18n System E2E Tests › User Language Preferences › should update user language preference (requires auth)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: undefined\n\n      130 |         .expect(401); // Expect unauthorized without auth\n      131 |\n    > 132 |       expect(response.body.success).toBe(false);\n          |                                     ^\n      133 |     });\n      134 |\n      135 |     test('should validate language preference input', async () => {\n\n      at Object.toBe (tests/e2e/i18n-system.e2e.js:132:37)\n\n  ● i18n System E2E Tests › User Language Preferences › should validate language preference input\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: undefined\n\n      139 |         .expect(401); // Still unauthorized, but this shows validation would happen\n      140 |\n    > 141 |       expect(response.body.success).toBe(false);\n          |                                     ^\n      142 |     });\n      143 |   });\n      144 |\n\n      at Object.toBe (tests/e2e/i18n-system.e2e.js:141:37)\n\n  ● i18n System E2E Tests › Organization Language Preferences › should get organization language preference (requires auth)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: undefined\n\n      149 |         .expect(401); // Expect unauthorized without auth\n      150 |\n    > 151 |       expect(response.body.success).toBe(false);\n          |                                     ^\n      152 |     });\n      153 |\n      154 |     test('should update organization language preference (requires auth)', async () => {\n\n      at Object.toBe (tests/e2e/i18n-system.e2e.js:151:37)\n\n  ● i18n System E2E Tests › Organization Language Preferences › should update organization language preference (requires auth)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: undefined\n\n      158 |         .expect(401); // Expect unauthorized without auth\n      159 |\n    > 160 |       expect(response.body.success).toBe(false);\n          |                                     ^\n      161 |     });\n      162 |   });\n      163 |\n\n      at Object.toBe (tests/e2e/i18n-system.e2e.js:160:37)\n\n  ● i18n System E2E Tests › Language Statistics API › should require admin permissions for statistics\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: undefined\n\n      168 |         .expect(401); // Expect unauthorized without auth\n      169 |\n    > 170 |       expect(response.body.success).toBe(false);\n          |                                     ^\n      171 |     });\n      172 |   });\n      173 |\n\n      at Object.toBe (tests/e2e/i18n-system.e2e.js:170:37)\n\nTest Suites: 1 failed, 1 total\nTests:       6 failed, 19 passed, 25 total\nSnapshots:   0 total\nTime:        4.401 s\nRan all test suites matching /\\/Users\\/daniellovazzano\\/Documents\\/Projects\\/pet-api-firebase\\/backend\\/tests\\/e2e\\/i18n-system.e2e.js/i.\n",
      "timestamp": "2025-06-05T17:10:31.975Z"
    }
  ],
  "productionReady": false
}